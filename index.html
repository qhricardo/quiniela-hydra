<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pron√≥sticos - Quiniela360</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 0;
    }
    header {
      background: #006847;
      color: white;
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .user-info {
      font-size: 14px;
    }
    .container {
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      color: #006847;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    td {
      padding: 12px;
      text-align: center;
      border-bottom: 1px solid #ddd;
    }
    .btn {
      padding: 10px 15px;
      margin: 5px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: 0.2s;
    }
    .btn:hover { opacity: 0.9; }
    .win { background: #28a745; color: white; }
    .draw { background: #ffc107; color: black; }
    .lose { background: #dc3545; color: white; }
    .selected { outline: 3px solid black; }
    #guardar-btn {
      display: block;
      margin: 30px auto 10px;
      padding: 15px 30px;
      background: #006847;
      color: white;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      border: none;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo"><h1>‚öΩ Quiniela360</h1></div>
    <div class="user-info">
      Usuario: <span id="username">Cargando...</span> | 
      Cr√©ditos: <span id="creditos">0</span> | 
      Grupo: <span id="grupoActual">Ninguno</span>
    </div>
  </header>
   <div style="text-align: center; margin-top: 30px;">
    <button onclick="window.location.href='interfaz.html'" style="padding: 10px 20px; background-color: #006847; color: white; border: none; border-radius: 5px; font-weight: bold; cursor: pointer;">
        ‚¨ÖÔ∏è Regresar a Grupos
    </button>
  </div>

  <div class="container">
    <h2>Pron√≥sticos - <span id="nombreGrupo">Selecciona un grupo</span></h2>
    <table id="tablaPartidos">
      <!-- Se llenan din√°micamente los 10 partidos -->
    </table>
    <button id="guardar-btn">üíæ Guardar Pron√≥sticos</button>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script>
    // Configuraci√≥n Firebase (reemplaza con tu config)
    const firebaseConfig = {
      apiKey: "TU_API_KEY",
      authDomain: "TU_AUTH_DOMAIN",
      projectId: "TU_PROJECT_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const usernameEl = document.getElementById("username");
    const creditosEl = document.getElementById("creditos");
    const grupoEl = document.getElementById("grupoActual");
    const nombreGrupoEl = document.getElementById("nombreGrupo");
    const tablaPartidos = document.getElementById("tablaPartidos");

    let grupoSeleccionado = localStorage.getItem("grupoSeleccionado") || null;
    let grupoNombre = localStorage.getItem("grupoNombre") || "Ninguno";
    let currentUser = null;

auth.onAuthStateChanged(async (user) => {
  if (user) {
    currentUser = user;

    // Buscar info en users/{uid}
    const userDoc = await db.collection("users").doc(user.uid).get();
    if (userDoc.exists) {
      usernameEl.textContent = userDoc.data().username || user.email;
      creditosEl.textContent = userDoc.data().creditos || 0;
    } else {
      usernameEl.textContent = user.email;
      creditosEl.textContent = 0;
    }
  }
});

// Mostrar grupo
grupoSeleccionado = localStorage.getItem("grupoSeleccionado");
grupoNombre = localStorage.getItem("grupoNombre");

grupoEl.textContent = grupoNombre || "Ninguno";
nombreGrupoEl.textContent = grupoNombre || "Ninguno";


    
    // Mostrar grupo
    grupoEl.textContent = grupoNombre;
    nombreGrupoEl.textContent = grupoNombre;

    // Partidos de ejemplo
    const partidos = [
      ["Am√©rica", "Chivas"],
      ["Pumas", "Cruz Azul"],
      ["Tigres", "Monterrey"],
      ["Toluca", "Santos"],
      ["Le√≥n", "Pachuca"],
      ["Atlas", "Quer√©taro"],
      ["Tijuana", "Necaxa"],
      ["Mazatl√°n", "Ju√°rez"],
      ["San Luis", "Le√≥n"],
      ["Santos", "Am√©rica"]
    ];

    // Render partidos
    partidos.forEach((p, i) => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${p[0]} vs ${p[1]}</td>
        <td>
          <button class="btn win" data-match="${i}" data-result="gana1">${p[0]} Gana</button>
          <button class="btn draw" data-match="${i}" data-result="empate">Empate</button>
          <button class="btn lose" data-match="${i}" data-result="gana2">${p[1]} Gana</button>
        </td>
      `;
      tablaPartidos.appendChild(row);
    });

    const pronosticos = {};

    // Selecci√≥n
    document.querySelectorAll(".btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const match = btn.dataset.match;
        const result = btn.dataset.result;

        pronosticos[match] = result;

        document.querySelectorAll(`[data-match="${match}"]`).forEach(b => b.classList.remove("selected"));
        btn.classList.add("selected");
      });
    });

    // Escuchar usuario
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        currentUser = user;
        usernameEl.textContent = user.displayName || user.email;

        // Leer cr√©ditos
        const userDoc = await db.collection("users").doc(user.uid).get();
        if (userDoc.exists) {
          creditosEl.textContent = userDoc.data().creditos || 0;
        }
      }
    });

document.getElementById("guardar-btn").addEventListener("click", async () => {
  if (!currentUser) {
    alert("Debes iniciar sesi√≥n.");
    return;
  }
  if (!grupoSeleccionado) {
    alert("Debes seleccionar un grupo.");
    return;
  }

  await db.collection("grupos")
    .doc(grupoSeleccionado)
    .collection("pronosticos")
    .doc(currentUser.uid) // üëà as√≠ cada user tiene solo un pron√≥stico
    .set({
      userId: currentUser.uid,
      userName: usernameEl.textContent,
      fecha: new Date(),
      pronosticos
    });

  alert("‚úÖ Pron√≥sticos guardados en " + grupoNombre);
  window.location.href = "resultados.html?grupo=" + grupoSeleccionado;
});


      await db.collection("grupos").doc(grupoSeleccionado)
        .collection("pronosticos").add({
          userId: currentUser.uid,
          userName: currentUser.displayName || currentUser.email,
          fecha: new Date(),
          pronosticos
        });

      alert("‚úÖ Pron√≥sticos guardados");
      window.location.href = "resultados.html?grupo=" + grupoSeleccionado;
    });
  </script>
</body>
</html>


